env:
  variables:
    AWS_ACCOUNT_ID     : "586359898361"
    AWS_DEFAULT_REGION : "ca-central-1"
    IMAGE_REPO_NAME    : "nartex-next"
  secrets-manager:
    DATABASE_URL       : nartex-db-credentials
    EMAIL_USER         : nartex-email-user         # <-- add in Secrets Manager
    EMAIL_PASS         : nartex-email-password     # <-- add in Secrets Manager

phases:
  build:
    commands:
      # â”€â”€â”€ Inject mail env vars for next build â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - export EMAIL_SERVER_HOST="smtp.mailgun.org"
      - export EMAIL_SERVER_PORT="587"
      - export EMAIL_SERVER_USER="$EMAIL_USER"
      - export EMAIL_SERVER_PASSWORD="$EMAIL_PASS"
      - export NEXTAUTH_URL="https://nartex.app"
      # â”€â”€â”€ existing commands follow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - echo "ðŸ—  BUILD â€“ resolving commit hash"
      - COMMIT_HASH=$(git rev-parse --short HEAD)
      ...
