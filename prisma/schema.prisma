generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. USER MODEL (Updated for NextAuth Adapter + Your Custom Fields)
model User {
  id            String    @id @default(cuid()) // Using cuid() is common for NextAuth, but uuid() is also fine.
  name          String?   // Populated by OAuth providers (e.g., "Nicolas Labranche")
  firstName     String?   @map("first_name") // Your custom field, mapped to snake_case
  lastName      String?   @map("last_name")  // Your custom field, mapped to snake_case
  email         String?   @unique // Must be optional for some OAuth providers, but unique if present
  emailVerified DateTime? @map("email_verified")
  image         String?   // Profile picture URL from OAuth
  password      String?   // For your credentials-based signup
  role          String    @default("user") // Your custom role field. Changed default to "user" as it's more common.

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Custom password reset fields (kept from your original schema)
  passwordResetToken   String?   @unique @map("password_reset_token")
  passwordResetExpires DateTime? @map("password_reset_expires")
  
  // Relations required by NextAuth adapter
  accounts Account[]
  sessions Session[]
}

// 2. ACCOUNT MODEL (Required by NextAuth Adapter)
// This links a User to an OAuth provider (e.g., their Google account).
model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

// 3. SESSION MODEL (Required by NextAuth Adapter)
// Used to store user sessions in the database.
model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// 4. VERIFICATION TOKEN MODEL (Required by NextAuth Adapter)
// Used for email verification, such as magic link sign-in or verifying email after signup.
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}